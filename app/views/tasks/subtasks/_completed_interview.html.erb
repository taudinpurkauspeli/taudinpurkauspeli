
<table class = "width100">
  <tr><td>&nbsp;</td><td>&nbsp;</td></tr> <%# fixing the fucking layout%>
  <% subtask.interview.question_groups.distinct.each do |group|%>
      <tr>
        <td class="multichoice">
          <h4><%= group.title %></h4>
        </td>
        <td></td>
      </tr>

      <% group.questions.where(interview: subtask.interview).each do |question| %>
          <tr>
            <td class="multichoice"><div class="floatLeft" style = "width: 5%;"></div>
              <% if !current_user.has_asked_question?(question) %>

                  <%= form_tag("/interviews/" + subtask.interview.id.to_s + "/ask_question", method: "post") do %>
                      <%= hidden_field_tag 'question_id', question.id %>
                      <%= submit_tag(question.title, :class => "btn btn-default multiline width95 floatRight") unless current_user.try(:admin) %>
                  <% end %>

              <% else %>
                  <%# TODO this should be refactored to make sense %>
                  <input class='btn btn-default btn-hypothesis-group multiline width95 floatRight 
                    <% if question.required == "required" %>
                        <%= "collapse-answer-right" %>
                      <% elsif question.required == "wrong" %>
                        <%= "collapse-answer-wrong" %>
                      <% else %>

                      <% end %>
                    ' type="button" value="<%= question.title %>" data-toggle="collapse" data-target="#collapseQuestionContent<%= question.id%>"/>
                  </td>
                  <td class="multichoice">
                    <div class='collapse in collapse-answer 
                      <% if question.required == "required" %>
                        <%= "collapse-answer-right" %>
                      <% elsif question.required == "wrong" %>
                        <%= "collapse-answer-wrong" %>
                      <% else %>

                      <% end %>
                      ' id="collapseQuestionContent<%= question.id%>" >
                      <%= image_tag question.image.picture.url(:original) unless question.image.nil? %>
                      <p><%= question.content.html_safe %></p>
                    </div>
              <%end %>
              </td>
              </tr>
      <% end %>

  <% end %>

  <% subtask.interview.questions.where(question_group:nil).each do |question| %>
      <tr>
        <td class="multichoice">
          <% if !current_user.has_asked_question?(question) %>
              <%= form_tag("/interviews/" + subtask.interview.id.to_s + "/ask_question", method: "post") do %>
                  <%= hidden_field_tag 'question_id', question.id %>
                  <%= submit_tag(question.title, :class => "btn btn-default multiline width100") unless current_user.try(:admin) %>
              <% end %>
          <% else %>
              <input class='btn btn-default btn-hypothesis-group multiline 
              <% if question.required == "required" %>
                        <%= "collapse-answer-right" %>
                      <% elsif question.required == "wrong" %>
                        <%= "collapse-answer-wrong" %>
                      <% else %>

                      <% end %>
              ' type="button" value="<%= question.title %>" data-toggle="collapse" data-target="#collapseQuestionContent<%= question.id%>"/>
              </td>
              <td class="multichoice">
                <div class='collapse in collapse-answer 
                  <% if question.required == "required" %>
                        <%= "collapse-answer-right" %>
                      <% elsif question.required == "wrong" %>
                        <%= "collapse-answer-wrong" %>
                      <% else %>

                      <% end %>
                  ' id="collapseQuestionContent<%= question.id%>" >
                  <%= image_tag question.image.picture.url(:original) unless question.image.nil? %>
                  <p><%= question.content.html_safe %></p>
                </div>
          <%end %>
          </td>
          </tr>
  <% end %>
</table>
<br />
