<div class = "row">
    <div class = "col-md-8">
        <h1>Opiskelijoiden etenemisen seuranta</h1>
    </div>
    <div class = "col-md-4">
        <a tabindex="0" class="btn btn-help floatRight" role="button" data-toggle="popover" data-trigger="focus" data-placement="bottom" title="Ohje" data-content="Pelin käyttäjät.">Ohje</a>
    </div>
</div>
<div class = "separator"></div>

<div>
    <h3>Etsi listalta</h3>

    <div class = "row">
        <div class = "col-md-2">
            <label for="queryCase" class="form-control">Case</label>
        </div>
        <div class = "col-md-8">
            <input type="text"
                   name="queryCase"
                   id="queryCase"
                   class="form-control input"
                   placeholder="Case"
                   ng-model="queryCase">
        </div>
    </div>

    <div class = "row">
        <div class = "col-md-2">
            <label for="queryStartingYear" class="form-control">Aloitusvuosi</label>
        </div>
        <div class = "col-md-8">
            <input type="text"
                   name="queryStartingYear"
                   id="queryStartingYear"
                   class="form-control input"
                   placeholder="Aloitusvuosi"
                   ng-model="queryStartingYear">
        </div>
    </div>

    <div class = "row">
        <div class = "col-md-2">
            <label for="queryFirstName" class="form-control">Etunimi</label>
        </div>
        <div class = "col-md-8">
            <input type="text"
                   name="queryFirstName"
                   id="queryFirstName"
                   class="form-control input"
                   placeholder="Etunimi"
                   ng-model="queryFirstName">
        </div>
    </div>

    <div class = "row">
        <div class = "col-md-2">
            <label for="queryLastName" class="form-control">Sukunimi</label>
        </div>
        <div class = "col-md-8">
            <input type="text"
                   name="queryLastName"
                   id="queryLastName"
                   class="form-control input"
                   placeholder="Sukunimi"
                   ng-model="queryLastName">
        </div>
    </div>

    <div class = "row">
        <div class = "col-md-2">
            <label for="queryStudentNumber" class="form-control">Opiskelijanumero</label>
        </div>
        <div class = "col-md-8">
            <input type="text"
                   name="queryStudentNumber"
                   id="queryStudentNumber"
                   class="form-control input"
                   placeholder="Opiskelijanumero"
                   ng-model="queryStudentNumber">
        </div>
    </div>

</div>

<br/>

<div class="row" ng-repeat="exerciseWithUsers in usersByCase | orderBy: 'exercise_name'" ng-if="!queryCase || queryMatchesCaseName(exerciseWithUsers.exercise_name)">
    <br/>
    <div class="col-md-12">
        <h3>{{exerciseWithUsers.exercise_name}}</h3>
    </div>
    <div class = "col-md-12">

        <div class="panel panel-default">
            <div class="panel-body">
                <table class = "width100">
                    <colgroup>
                        <col style="width:20%" />
                        <col style="width:20%" />
                        <col style="width:15%" />
                        <col style="width:20%" />
                        <col style="width:25%" />
                    </colgroup>
                    <thead>
                    <tr>
                        <th class="user" ng-click="setOrderByAttribute('first_name')">Etunimi <span class="sortorder" ng-show="orderByAttribute === 'first_name'" ng-class="{reverse:reverse}"></span></th>
                        <th class="user" ng-click="setOrderByAttribute('last_name')">Sukunimi <span class="sortorder" ng-show="orderByAttribute === 'last_name'" ng-class="{reverse:reverse}"></span></th>
                        <th class="user" ng-click="setOrderByAttribute('student_number')">Opiskelijanumero <span class="sortorder" ng-show="orderByAttribute === 'student_number'" ng-class="{reverse:reverse}"></span></th>
                        <th class="user" ng-click="setOrderByAttribute('starting_year')">Epidemiologian kurssin aloitusvuosi <span class="sortorder" ng-show="orderByAttribute === 'starting_year'" ng-class="{reverse:reverse}"></span></th>
                        <th class="user" ng-click="setOrderByAttribute('percent_of_completed_tasks')">Suoritettu <span class="sortorder" ng-show="orderByAttribute === 'percent_of_completed_tasks'" ng-class="{reverse:reverse}"></span></th>
                    </tr>
                    </thead>
                    <tbody>

                    <tr ng-repeat="user in exerciseWithUsers.exercise_users | orderBy: orderByAttribute:reverse |
                    filter:{starting_year: queryStartingYear, first_name: queryFirstName, last_name: queryLastName, student_number: queryStudentNumber}">
                        <td class="user" ng-click="viewUser(user)">{{user.first_name}}</td>
                        <td class="user">{{user.last_name}}</td>
                        <td class="user">{{user.student_number}}</td>
                        <td class="user">{{user.starting_year}}</td>
                        <td class="user">
                            <div class ="progressbar" ng-class="{'completed': user.percent_of_completed_tasks >= 100}">
                                <div ng-if="user.percent_of_completed_tasks < 100" class = "progressbar progress" ng-style="{'width': 100 - user.percent_of_completed_tasks}"></div>
                            </div>
                            <span class = "progress-percent">{{user.percent_of_completed_tasks}}%</span>
                        </td>

                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>

</div>
